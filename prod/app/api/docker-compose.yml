# API Services - prod/app/api/docker-compose.yml
version: '3.8'

services:
  hub-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hub_service
    environment:
      DATABASE_URL: jdbc:postgresql://profile_measurements:5432/profile_measurements
      DATABASE_USERNAME: ${DATABASE_USERNAME:-tcc}
      DATABASE_PASSWORD: ${DATABASE_PASSWORD:-tcc}
      SPRING_DATASOURCE_URL: jdbc:postgresql://profile_measurements:5432/profile_measurements
      SPRING_DATASOURCE_USERNAME: tcc
      SPRING_DATASOURCE_PASSWORD: tcc
      SERVER_PORT: 8080

    ports:
      - "${API_PORT:-8080}:8080"
    volumes:
      - api_uploads:/app/uploads
    networks:
      - tcc
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8080/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  api_uploads:
    driver: local
    name: hub_services_uploads

networks:
  tcc:
    name: tcc
    external: true
